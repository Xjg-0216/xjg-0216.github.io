# c++å¸¸è§é—®é¢˜

## 1. æ®µé”™è¯¯(Segmentation Fault)å¸¸è§åŸå› 

æ®µé”™è¯¯(Segmentation Fault, ç®€ç§°Segfault)æ˜¯ç¨‹åºè¯•å›¾è®¿é—®æœªè¢«å…è®¸è®¿é—®çš„å†…å­˜åŒºåŸŸæ—¶å‘ç”Ÿçš„é”™è¯¯ã€‚ä»¥ä¸‹æ˜¯å¯èƒ½å¯¼è‡´æ®µé”™è¯¯çš„å¸¸è§åŸå› ï¼š

**ç©ºæŒ‡é’ˆè§£å¼•ç”¨**
```c
int *p = NULL;
*p = 42;  // è§£å¼•ç”¨ç©ºæŒ‡é’ˆ
```

**è®¿é—®å·²é‡Šæ”¾çš„å†…å­˜**
```c
int *p = malloc(sizeof(int));
free(p);
*p = 10;  // è®¿é—®å·²é‡Šæ”¾çš„å†…å­˜
```

**æ•°ç»„è¶Šç•Œè®¿é—®**
```c
int arr[10];
arr[10] = 5;  // è¶Šç•Œè®¿é—®ï¼Œåˆæ³•ç´¢å¼•æ˜¯0-9
```

**æ ˆæº¢å‡º**
```c
void recursive_func() {
    recursive_func();  // æ— é™é€’å½’å¯¼è‡´æ ˆæº¢å‡º
}
```

**ä¿®æ”¹å­—ç¬¦ä¸²å¸¸é‡**
```c
char *str = "constant string";
str[0] = 'C';  // å°è¯•ä¿®æ”¹åªè¯»å†…å­˜åŒºåŸŸ
```

**é”™è¯¯çš„æŒ‡é’ˆè¿ç®—**
```c
int arr[10];
int *p = arr - 1;  // éæ³•çš„æŒ‡é’ˆè¿ç®—
*p = 0;
```

**é”™è¯¯çš„ç±»å‹è½¬æ¢**
```c
int num = 10;
char *p = (char *)num;  // é”™è¯¯çš„ç±»å‹è½¬æ¢
*p = 'a';
```

**å¤šçº¿ç¨‹ç«äº‰æ¡ä»¶**
å¤šä¸ªçº¿ç¨‹åŒæ—¶è®¿é—®åŒä¸€å†…å­˜åŒºåŸŸï¼Œå¯èƒ½å¯¼è‡´ä¸å¯é¢„æµ‹çš„è¡Œä¸ºã€‚

**è°ƒè¯•æ®µé”™è¯¯çš„å·¥å…·å’Œæ–¹æ³•**

1. **gdb**ï¼šGNUè°ƒè¯•å™¨ï¼Œå¯ä»¥å®šä½æ®µé”™è¯¯å‘ç”Ÿçš„ä½ç½®
   ```
   gcc -g program.c -o program
   gdb ./program
   ```

2. **valgrind**ï¼šå†…å­˜è°ƒè¯•å·¥å…·
   ```
   valgrind ./program
   ```

3. **æ ¸å¿ƒè½¬å‚¨æ–‡ä»¶**ï¼šåˆ†æç¨‹åºå´©æºƒæ—¶çš„å†…å­˜çŠ¶æ€
   ```
   ulimit -c unlimited
   ./program  # å´©æºƒåç”Ÿæˆcoreæ–‡ä»¶
   gdb program core
   ```

4. **æ‰“å°è°ƒè¯•**ï¼šåœ¨å…³é”®ä½ç½®æ·»åŠ æ‰“å°è¯­å¥

é¢„é˜²æ®µé”™è¯¯çš„æœ€ä½³å®è·µåŒ…æ‹¬ï¼š**å§‹ç»ˆåˆå§‹åŒ–æŒ‡é’ˆ**ã€**æ£€æŸ¥å†…å­˜åˆ†é…æ˜¯å¦æˆåŠŸ**ã€**é¿å…è¶Šç•Œè®¿é—®**ã€**è°¨æ…ä½¿ç”¨æŒ‡é’ˆè¿ç®—**ç­‰ã€‚


## 2. æ™ºèƒ½æŒ‡é’ˆå¦‚ä½•å…‹æœè£¸æŒ‡é’ˆçš„é—®é¢˜

æ™ºèƒ½æŒ‡é’ˆæ˜¯C++ä¸­ç®¡ç†åŠ¨æ€å†…å­˜çš„RAII(èµ„æºè·å–å³åˆå§‹åŒ–)å¯¹è±¡ï¼Œå®ƒä»¬å…‹æœäº†è£¸æŒ‡é’ˆçš„è®¸å¤šå¸¸è§é—®é¢˜ï¼š

### 2.1 å†…å­˜æ³„æ¼é—®é¢˜
**è£¸æŒ‡é’ˆé—®é¢˜**ï¼šéœ€è¦æ‰‹åŠ¨`delete`ï¼Œå®¹æ˜“å¿˜è®°é‡Šæ”¾å†…å­˜
```cpp
void func() {
    int* p = new int(10);
    // å¦‚æœè¿™é‡ŒæŠ›å‡ºå¼‚å¸¸æˆ–å¿˜è®°deleteï¼Œå°±ä¼šå†…å­˜æ³„æ¼
    // delete p;
}
```

**æ™ºèƒ½æŒ‡é’ˆè§£å†³**ï¼šè‡ªåŠ¨é‡Šæ”¾å†…å­˜
```cpp
void func() {
    std::unique_ptr<int> p(new int(10));
    // ç¦»å¼€ä½œç”¨åŸŸæ—¶è‡ªåŠ¨é‡Šæ”¾
}
```

### 2.2 æ‚¬å‚æŒ‡é’ˆé—®é¢˜
**è£¸æŒ‡é’ˆé—®é¢˜**ï¼šè®¿é—®å·²é‡Šæ”¾çš„å†…å­˜
```cpp
int* p = new int(10);
delete p;
*p = 20; // æœªå®šä¹‰è¡Œä¸º
```

**æ™ºèƒ½æŒ‡é’ˆè§£å†³**ï¼š
- `unique_ptr`ï¼šç‹¬å æ‰€æœ‰æƒï¼Œä¸å¯èƒ½å‡ºç°æ‚¬å‚æŒ‡é’ˆ
- `shared_ptr`ï¼šå¼•ç”¨è®¡æ•°ï¼Œæœ€åä¸€ä¸ªå¼•ç”¨æ¶ˆå¤±æ—¶æ‰é‡Šæ”¾
- `weak_ptr`ï¼šä¸å¢åŠ å¼•ç”¨è®¡æ•°ï¼Œå¯æ£€æµ‹å¯¹è±¡æ˜¯å¦å·²è¢«é‡Šæ”¾

### 2.3 æ‰€æœ‰æƒä¸æ˜ç¡®é—®é¢˜
**è£¸æŒ‡é’ˆé—®é¢˜**ï¼šæ— æ³•æ˜ç¡®è°è´Ÿè´£é‡Šæ”¾å†…å­˜
```cpp
int* create() { return new int(10); }
void consume(int* p) { delete p; }

int* p = create();
// è°è´Ÿè´£deleteï¼Ÿä¸æ¸…æ¥š
```

**æ™ºèƒ½æŒ‡é’ˆè§£å†³**ï¼šæ˜ç¡®æ‰€æœ‰æƒè¯­ä¹‰
```cpp
std::unique_ptr<int> create() { return std::make_unique<int>(10); }
// æ‰€æœ‰æƒè½¬ç§»æ˜ç¡®
void consume(std::unique_ptr<int> p) {}

auto p = create();
consume(std::move(p)); // æ˜ç¡®çš„æ‰€æœ‰æƒè½¬ç§»
```

### 2.4 å¼‚å¸¸å®‰å…¨é—®é¢˜
**è£¸æŒ‡é’ˆé—®é¢˜**ï¼šå¼‚å¸¸å¯èƒ½å¯¼è‡´å†…å­˜æ³„æ¼
```cpp
void func() {
    int* p = new int(10);
    some_function_that_may_throw(); // å¦‚æœæŠ›å‡ºå¼‚å¸¸
    delete p; // è¿™è¡Œä¸ä¼šæ‰§è¡Œ
}
```

**æ™ºèƒ½æŒ‡é’ˆè§£å†³**ï¼šå¼‚å¸¸å®‰å…¨
```cpp
void func() {
    auto p = std::make_unique<int>(10);
    some_function_that_may_throw(); // å³ä½¿æŠ›å‡ºå¼‚å¸¸
    // pä¹Ÿä¼šè¢«æ­£ç¡®é‡Šæ”¾
}
```

### 2.5 å¤šçº¿ç¨‹å®‰å…¨é—®é¢˜
**è£¸æŒ‡é’ˆé—®é¢˜**ï¼šå¤šçº¿ç¨‹ç¯å¢ƒä¸‹éš¾ä»¥å®‰å…¨å…±äº«æ•°æ®
```cpp
int* shared_data = new int(0);

// çº¿ç¨‹1
*shared_data = 42;

// çº¿ç¨‹2
int val = *shared_data; // æ•°æ®ç«äº‰
```

**æ™ºèƒ½æŒ‡é’ˆè§£å†³**ï¼š
```cpp
auto shared_data = std::make_shared<int>(0);

// çº¿ç¨‹å®‰å…¨å–å†³äºå¦‚ä½•ä½¿ç”¨ï¼Œä½†shared_ptræœ¬èº«ä¿è¯å¼•ç”¨è®¡æ•°åŸå­æ“ä½œ
// ç»“åˆmutexå¯å®ç°çº¿ç¨‹å®‰å…¨è®¿é—®
```

### ä¸»è¦æ™ºèƒ½æŒ‡é’ˆç±»å‹åŠå…¶ç”¨é€”

1. **`unique_ptr`**ï¼š
   - ç‹¬å æ‰€æœ‰æƒ
   - è½»é‡çº§ï¼Œé›¶å¼€é”€
   - ä¸å¯å¤åˆ¶ï¼Œåªèƒ½ç§»åŠ¨

2. **`shared_ptr`**ï¼š
   - å…±äº«æ‰€æœ‰æƒ
   - å¼•ç”¨è®¡æ•°
   - å¯å¤åˆ¶ï¼Œè¾ƒé‡çš„å¼€é”€

3. **`weak_ptr`**ï¼š
   - ä¸å¢åŠ å¼•ç”¨è®¡æ•°
   - è§£å†³shared_ptrå¾ªç¯å¼•ç”¨é—®é¢˜
   - å¿…é¡»è½¬æ¢ä¸ºshared_ptræ‰èƒ½è®¿é—®å¯¹è±¡

æ™ºèƒ½æŒ‡é’ˆé€šè¿‡è‡ªåŠ¨åŒ–å†…å­˜ç®¡ç†å’Œæ˜ç¡®æ‰€æœ‰æƒè¯­ä¹‰ï¼Œå¤§å¤§å‡å°‘äº†C++ä¸­ä¸è£¸æŒ‡é’ˆç›¸å…³çš„å¸¸è§é”™è¯¯ï¼Œæ˜¯ç°ä»£C++å†…å­˜ç®¡ç†çš„é¦–é€‰æ–¹å¼ã€‚

## 3. NULLå’Œnullptr


| æ¯”è¾ƒé¡¹      | `nullptr`        | `NULL`                    |
| -------- | ---------------- | ------------------------- |
| ç±»å‹       | `std::nullptr_t` | å®ï¼ˆé€šå¸¸æ˜¯ `0` æˆ– `((void*)0)`ï¼‰ |
| æ˜¯å¦ç±»å‹å®‰å…¨   | âœ… ç±»å‹å®‰å…¨           | âŒ å¯èƒ½ä¸æ•´å‹æ··æ·†                 |
| C++11 å¼•å…¥ | âœ…                | âŒï¼ˆC/C++éƒ½æœ‰ï¼‰                |
| æ¨èç¨‹åº¦     | âœ… æ¨èï¼ˆç°ä»£ C++ï¼‰     | âŒ ä¸æ¨èï¼ˆå·²è¿‡æ—¶ï¼‰                |


```cpp
void func(int);
void func(void*);

func(NULL);     // è°ƒç”¨ func(int)?  func(void*)? ç¼–è¯‘å™¨å¯èƒ½æ­§ä¹‰
func(nullptr);  // æ˜ç¡®è°ƒç”¨ func(void*)
```

âš ï¸ **NULL çš„é—®é¢˜**

åœ¨ C++ ä¸­ `NULL` é€šå¸¸æ˜¯ `#define NULL 0`ï¼Œå³å®ƒæ˜¯ `int` ç±»å‹ï¼Œå› æ­¤ä¼šå‡ºç°å‡½æ•°é‡è½½æ­§ä¹‰ã€‚

**ä¸ºä»€ä¹ˆ `nullptr` æ›´å¥½**

1. `nullptr` æ˜¯ä¸€ä¸ªçœŸæ­£çš„â€œç©ºæŒ‡é’ˆâ€ç±»å‹

```cpp
std::nullptr_t np = nullptr;  // OK
int i = nullptr;              // âŒ é”™è¯¯ï¼šä¸èƒ½å°† nullptr èµ‹å€¼ç»™ int
```

2. `nullptr` ä¸ä¼šå’Œæ•´å‹å†²çª

```cpp
void foo(int x);
void foo(char* p);

foo(0);        // è°ƒç”¨ foo(int)
foo(NULL);     // è°ƒç”¨ foo(int)ï¼Œå®¹æ˜“è¯¯åˆ¤
foo(nullptr);  // è°ƒç”¨ foo(char*)ï¼Œå®‰å…¨
```

| åœºæ™¯        | æ¨èåšæ³•                                         |
| --------- | -------------------------------------------- |
| C++11 åŠä»¥å | ä½¿ç”¨ `nullptr` æ›¿ä»£ `NULL`                       |
| ä¸ C åº“æ¥å£   | å¯ä»¥ç»§ç»­ä½¿ç”¨ `NULL`ï¼ˆå…¼å®¹ï¼‰                            |
| åˆ¤æ–­æŒ‡é’ˆæ˜¯å¦ä¸ºç©º  | `if (ptr == nullptr)`ï¼Œä¸è¦å†™ `if (ptr == NULL)` |

å¦‚ä½ ç”¨çš„æ˜¯ C++11 åŠä»¥ä¸Šç‰ˆæœ¬ï¼ˆå»ºè®®é»˜è®¤ä½¿ç”¨ï¼‰ï¼Œ**è¯·é¿å…ä½¿ç”¨ `NULL`ï¼Œç»Ÿä¸€ç”¨ `nullptr`**ã€‚è¿™æ ·å¯ä»¥é¿å…äºŒä¹‰æ€§å’Œç±»å‹é”™è¯¯

## 4. æŒ‡é’ˆå¯¹æ¯”

è¿™ä¸‰ä¸ªçœ‹èµ·æ¥å¾ˆç›¸ä¼¼çš„ C/C++ å£°æ˜ï¼š

```cpp
int *p[10];
int (*p)[10];
int *p(int);
```

è¯­æ³•ç»“æ„ä¸ä¸€æ ·ï¼Œ**å«ä¹‰å®Œå…¨ä¸åŒ**ã€‚ä¸‹é¢æˆ‘é€ä¸ªä¸ºä½ æ¸…æ™°è§£é‡Šã€‚


### 4.1 `int *p[10];`


> `p` æ˜¯ä¸€ä¸ª**æ•°ç»„**ï¼Œè¿™ä¸ªæ•°ç»„æœ‰ 10 ä¸ªå…ƒç´ ï¼Œ**æ¯ä¸ªå…ƒç´ æ˜¯ `int*` ç±»å‹**ï¼ˆå³æŒ‡å‘ int çš„æŒ‡é’ˆï¼‰ã€‚


```text
p: â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€ ... â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ int*       â”‚ int*       â”‚          â”‚ int*       â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     p[0]        p[1]                     p[9]
```


```cpp
int a = 1, b = 2;
int *p[10];     // æ•°ç»„ï¼Œæ¯ä¸ªå…ƒç´ éƒ½æ˜¯ int*
p[0] = &a;
p[1] = &b;
```


### 4.2 `int (*p)[10];`


> `p` æ˜¯ä¸€ä¸ª**æŒ‡é’ˆ**ï¼Œè¿™ä¸ªæŒ‡é’ˆæŒ‡å‘ä¸€ä¸ª**åŒ…å« 10 ä¸ª `int` å…ƒç´ çš„æ•°ç»„**ã€‚


```text
p â”€â”€â–º [ int, int, int, ..., int ]  // é•¿åº¦ä¸º10çš„æ•°ç»„
```

### ä¸¾ä¾‹ä½¿ç”¨ï¼š

```cpp
int arr[10];
int (*p)[10];   // p æ˜¯ä¸€ä¸ªæŒ‡å‘ int[10] çš„æŒ‡é’ˆ
p = &arr;       // æ³¨æ„ï¼šå–åœ°å€æ—¶è¦å–æ•´ä¸ªæ•°ç»„çš„åœ°å€
```

> è¿™ç§å†™æ³•é€šå¸¸ç”¨äºäºŒç»´æ•°ç»„ã€ä¼ é€’æ•°ç»„å¼•ç”¨ç­‰åœºæ™¯ã€‚


### 4.3 `int *p(int);`


> `p` æ˜¯ä¸€ä¸ª**å‡½æ•°**ï¼Œå®ƒæ¥å—ä¸€ä¸ª `int` ç±»å‹çš„å‚æ•°ï¼Œè¿”å›ä¸€ä¸ª `int*` ç±»å‹çš„å€¼ã€‚


```cpp
int* p(int x) {
    static int val = x;
    return &val;
}
```

ä¹Ÿå¯ä»¥æ˜¯å‡½æ•°å£°æ˜ï¼š

```cpp
int *p(int);  // å£°æ˜ä¸€ä¸ªå‡½æ•°ï¼Œè¿”å› int* ç±»å‹
```

### 4.4 `int (*p)(int)`


> `p` æ˜¯ä¸€ä¸ª**å‡½æ•°æŒ‡é’ˆ**ï¼Œå®ƒæŒ‡å‘ä¸€ä¸ªå‡½æ•°ï¼Œè¿™ä¸ªå‡½æ•°**æ¥æ”¶ä¸€ä¸ª `int` å‚æ•°ï¼Œè¿”å›ä¸€ä¸ª `int` ç±»å‹**çš„å€¼ã€‚


1. å…ˆçœ‹ `p`ï¼šå®ƒè¢« `(*p)` åŒ…è£¹ â†’ `p` æ˜¯**æŒ‡é’ˆ**
2. ç„¶åçœ‹å¤–é¢çš„ `(int)` â†’ è¿™ä¸ªæŒ‡é’ˆ**æŒ‡å‘ä¸€ä¸ªä»¥ `int` ä¸ºå‚æ•°çš„å‡½æ•°**
3. æœ€å·¦è¾¹ `int` æ˜¯è¿™ä¸ªå‡½æ•°çš„è¿”å›ç±»å‹

æ‰€ä»¥æ•´ä½“æ„æ€ï¼š

```text
p æ˜¯ä¸€ä¸ªå‡½æ•°æŒ‡é’ˆï¼šæŒ‡å‘ä¸€ä¸ª (int) â†’ int çš„å‡½æ•°
```


```cpp
int add_one(int x) {
    return x + 1;
}
```
```cpp
int (*p)(int);  // å£°æ˜å‡½æ•°æŒ‡é’ˆ
p = add_one;    // æŒ‡å‘å‡½æ•°
```

```cpp
int result = p(10);      // å’Œè°ƒç”¨å‡½æ•°ä¸€æ ·
// æˆ–è€… (*p)(10);         // ä¹Ÿæ˜¯åˆæ³•å†™æ³•
```

**å‡½æ•°æŒ‡é’ˆåœ¨å®é™…ç”¨é€”**

* å›è°ƒå‡½æ•°ï¼ˆå¦‚ sort æ¯”è¾ƒå™¨ï¼‰
* æ¥å£å‡½æ•°æ˜ å°„
* åŠ¨æ€é€‰æ‹©ç®—æ³•ï¼ˆç­–ç•¥æ¨¡å¼ï¼‰
* äº‹ä»¶å¤„ç†æœºåˆ¶


| å£°æ˜               | å«ä¹‰                                            |
| ---------------- | --------------------------------------------- |
| `int *p[10];`    | **æ•°ç»„**ï¼šåŒ…å« 10 ä¸ªæŒ‡å‘ `int` çš„æŒ‡é’ˆ                    |
| `int (*p)[10];`  | **æŒ‡é’ˆ**ï¼šæŒ‡å‘ä¸€ä¸ª `int[10]` çš„æ•°ç»„                     |
| `int *p(int);`   | **å‡½æ•°**ï¼šæ¥å—ä¸€ä¸ª `int` å‚æ•°ï¼Œè¿”å›ä¸€ä¸ª `int*`              |
| `int (*p)(int);` | **å‡½æ•°æŒ‡é’ˆ**ï¼š`p` æ˜¯æŒ‡é’ˆï¼ŒæŒ‡å‘ä¸€ä¸ªæ¥å— `int` å‚æ•°ã€è¿”å› `int` çš„å‡½æ•° |



### ğŸ”§è®°å¿†å°æŠ€å·§

| è§„åˆ™è¯´æ˜                                       | ç¤ºä¾‹                          |
| ------------------------------------------ | --------------------------- |
| `[]` ä¼˜å…ˆçº§æ¯” `*` é«˜ â†’ `int *p[10]` æ˜¯æ•°ç»„ï¼Œä¸æ˜¯æŒ‡é’ˆ    | âœ…                           |
| `()` åŒ…ä½ `*` å¯ä»¥æ”¹å˜ç»“åˆé¡ºåº â†’ `(*p)[10]` æ˜¯æŒ‡é’ˆï¼ŒæŒ‡å‘æ•°ç»„ | âœ…                           |
| `p(int)` è¯´æ˜æ˜¯ä¸ªå‡½æ•°                            | `int *p(int)` æ˜¯å‡½æ•°ï¼Œè¿”å› `int*` |
| `(*p)(int)` è¡¨ç¤ºå‡½æ•°æŒ‡é’ˆ                         | `p` æ˜¯æŒ‡å‘å‡½æ•°çš„æŒ‡é’ˆï¼Œè¿”å› `int`       |



## 5. c++/Cçš„åŒºåˆ«

* c++ä¸­new/deleteæ˜¯å¯¹å†…å­˜åˆ†é…çš„è¿ç®—ç¬¦ï¼Œ å–ä»£äº†Cä¸­çš„malloc/freeï¼›
* æ ‡å‡†C++ä¸­çš„å­—ç¬¦ä¸²å–ä»£äº†Cå‡½æ•°åº“å¤´æ–‡ä»¶ä¸­å­—ç¬¦æ•°ç»„å¤„ç†å‡½æ•°ï¼ŒCä¸­æ²¡æœ‰å­—ç¬¦ä¸²ç±»å‹ï¼›
* C++ä¸­ç”¨æ¥åšæ§åˆ¶è¾“å…¥è¾“å‡ºçš„iostreamç±»åº“å–ä»£äº†æ ‡å‡†Cä¸­çš„stdioå‡½æ•°åº“ï¼›
* c++ä¸­çš„try/catch/throwå¼‚å¸¸å¤„ç†æœºåˆ¶å–ä»£äº†Cä¸­çš„setjmp()å’Œongjmp()å‡½æ•°ï¼›
* åœ¨c++ä¸­ï¼Œå…è®¸æœ‰ç›¸åŒçš„å‡½æ•°åï¼Œ ä¸è¿‡å®ƒä»¬çš„å‚æ•°ç±»å‹ä¸èƒ½å®Œå…¨ç›¸åŒï¼Œè¿™æ ·è¿™äº›å‡½æ•°å¯ä»¥åŒºåˆ«å¼€æ¥ï¼Œè€Œè¿™äº›Cè¯­è¨€ä¸­äº‹ä¸å…è®¸çš„ï¼Œ ä¹Ÿå°±æ˜¯C++å¯ä»¥é‡è½½ï¼Œ Cè¯­è¨€ä¸å…è®¸ï¼›
* c++è¯­è¨€ä¸­ï¼Œå…è®¸å˜é‡å®šä¹‰è¯­å¥åœ¨ç¨‹åºä¸­çš„ä»»ä½•åœ°æ–¹ï¼Œåªè¦æ˜¯åœ¨ä½¿ç”¨å®ƒä¹‹å‰å°±å¯ä»¥ï¼›cè¯­è¨€ä¸­ï¼Œå¿…é¡»è¦åœ¨å‡½æ•°å¼€å¤´éƒ¨åˆ†ï¼Œè€Œä¸”C++ä¸å…è®¸é‡å¤å®šä¹‰å˜é‡ï¼Œ Cè¯­è¨€åšä¸åˆ°è¿™ä¸€ç‚¹ï¼›
* åœ¨c++ä¸­ï¼Œé™¤äº†å€¼å’ŒæŒ‡é’ˆä¹‹å¤–ï¼Œæ–°å¢äº†å¼•ç”¨ã€‚å¼•ç”¨å‹å˜é‡æ˜¯å…¶ä»–å˜é‡çš„ä¸€ä¸ªåˆ«åï¼Œæˆ‘ä»¬å¯ä»¥è®¤ä¸ºä»–ä»¬åªæ˜¯åå­—ä¸ç›¸åŒï¼Œå…¶ä»–éƒ½æ˜¯ç›¸åŒçš„ï¼›
* c++ç›¸å¯¹äºcå¢åŠ äº†ä¸€äº›å…³é”®å­—ï¼Œ å¦‚ï¼šbool, using, dynamic_cast, namespaceç­‰ï¼›


## 6. `extern"C"`ç”¨æ³•


`extern "C"` æ˜¯ C++ ä¸­çš„ä¸€ä¸ª**è¯­è¨€è¿æ¥è§„èŒƒå£°æ˜**ï¼Œä¸»è¦ç”¨äºè§£å†³ **C++ ä¸ C è¯­è¨€æ··ç¼–æ—¶çš„é“¾æ¥å…¼å®¹æ€§é—®é¢˜**ã€‚
å®ƒå‘Šè¯‰ç¼–è¯‘å™¨ï¼š**æŒ‰ç…§ C è¯­è¨€çš„æ–¹å¼æ¥å¤„ç†è¢«åŒ…è£¹çš„å‡½æ•°æˆ–å˜é‡åï¼Œä¸è¿›è¡Œ C++ åå­—ä¿®é¥°ï¼ˆname manglingï¼‰**ã€‚



> **é˜²æ­¢ C++ ç¼–è¯‘å™¨å¯¹å‡½æ•°åè¿›è¡Œé‡æ•´ï¼ˆname manglingï¼‰ï¼Œä½¿å¾— C++ èƒ½è°ƒç”¨ C ç¼–è¯‘çš„å‡½æ•°ï¼Œæˆ–è®© C èƒ½è°ƒç”¨ C++ çš„å‡½æ•°ã€‚**


ä¾‹å¦‚ä¸‹é¢è¿™ä¸ª C++ å‡½æ•°ï¼š

```cpp
int add(int a, int b);
```

åœ¨ C++ ç¼–è¯‘åï¼Œå‡½æ•°åå¯èƒ½å˜æˆè¿™æ ·ï¼š

```cpp
_add_int_int__FiT1  // ä¸¾ä¾‹ï¼Œå› å‚æ•°ç±»å‹ä¸åŒåå­—ä¼šå˜åŒ–
```

è€Œ C è¯­è¨€ä¸­ä¸åšè¿™ç§å¤„ç†ï¼Œå‡½æ•°åå°±ç®€å•æ˜¯ `add`ã€‚


### 6.1 å£°æ˜ä¸€ä¸ª C é£æ ¼çš„å¤–éƒ¨å‡½æ•°

```cpp
extern "C" int add(int a, int b);
```

å‘Šè¯‰ C++ ç¼–è¯‘å™¨ï¼š`add` æ˜¯ä¸€ä¸ª C é£æ ¼çš„å‡½æ•°ï¼Œä¸è¦åš name manglingã€‚


### 6.2 åœ¨å¤´æ–‡ä»¶ä¸­åŒ…è£¹ C æ¥å£ï¼ˆæ¨èå†™æ³•ï¼‰

```cpp
// mylib.h
#ifdef __cplusplus
extern "C" {
#endif

void c_function();  // å£°æ˜çš„å‡½æ•°å°†ä½¿ç”¨ C é“¾æ¥è§„åˆ™

#ifdef __cplusplus
}
#endif
```

> âœ… è¿™æ ·å¯ä»¥è®© `.h` å¤´æ–‡ä»¶åŒæ—¶è¢« C å’Œ C++ åŒ…å«ï¼Œå®‰å…¨é€šç”¨ã€‚

å‡è®¾æœ‰ä¸€ä¸ª C æ–‡ä»¶ï¼š

```c
// foo.c
#include <stdio.h>

void hello() {
    printf("Hello from C\n");
}
```

å¯¹åº”çš„å¤´æ–‡ä»¶ï¼š

```c
// foo.h
#ifndef FOO_H
#define FOO_H

void hello();

#endif
```

ç„¶ååœ¨ C++ ä¸­è°ƒç”¨ï¼š

```cpp
// main.cpp
extern "C" {
#include "foo.h"
}

int main() {
    hello();
    return 0;
}
```


```cpp
extern "C" class MyClass {};  // âŒ é”™è¯¯ï¼Œç±»ä¸èƒ½ extern "C"
```

## 7. é‡æŒ‡é’ˆå’Œæ‚¬ç©ºæŒ‡é’ˆ

é‡æŒ‡é’ˆï¼šæ²¡æœ‰è¢«åˆå§‹åŒ–è¿‡çš„æŒ‡é’ˆ

```cpp
int main(){
   int *p;
   std::cout << *p << std::endl; // æœªåˆå§‹åŒ–è¿‡å°±è¢«ä½¿ç”¨
   return 0;
}
```
å› æ­¤ï¼Œä¸ºäº†é˜²æ­¢å‡ºé”™ï¼Œå¯¹äºæŒ‡é’ˆåˆå§‹åŒ–æ—¶éƒ½æ˜¯èµ‹å€¼ä¸ºnullptrï¼Œè¿™æ ·åœ¨ä½¿ç”¨æ—¶ç¼–è¯‘å™¨å°±ä¸ä¼šç›´æ¥æŠ¥é”™ï¼Œäº§ç”Ÿéæ³•å†…å­˜è®¿é—®ï¼›

æ‚¬ç©ºæŒ‡é’ˆï¼š æŒ‡é’ˆæœ€åˆæŒ‡å‘çš„å†…å­˜å·²ç»è¢«é‡Šæ”¾äº†çš„ä¸€ç§æŒ‡é’ˆ

```cpp
int main()
{
   int *p = nullptr;
   int *p2 = new int(0);
   p = p2;
   delete p2;
   return 0;
}
```
æ­¤æ—¶ p å’Œp2å°±æ˜¯æ‚¬ç©ºæŒ‡é’ˆï¼ŒæŒ‡å‘çš„å†…å­˜å·²ç»è¢«é‡Šæ”¾ï¼Œç»§ç»­ä½¿ç”¨è¿™ä¿©æŒ‡é’ˆï¼Œè¡Œä¸ºä¸å¯é¢„æ–™ã€‚éœ€è¦è®¾ç½®`p=p2=nullptr`ï¼Œæ­¤æ—¶å†ä½¿ç”¨ï¼Œç¼–è¯‘å™¨ä¼šç›´æ¥æŠ¥é”™ã€‚é¿å…é‡æŒ‡é’ˆæ¯”è¾ƒç®€å•ï¼Œä½†æ‚¬ç©ºæŒ‡é’ˆæ¯”è¾ƒéº»çƒ¦ã€‚c++å¼•å…¥äº†æ™ºèƒ½æŒ‡é’ˆï¼Œæœ¬è´¨å°±æ˜¯é¿å…æ‚¬ç©ºæŒ‡é’ˆçš„äº§ç”Ÿ


## 8. æµ…æ‹·è´å’Œæ·±æ‹·è´

**æµ…æ‹·è´**

æµ…æ‹·è´åªæ˜¯æ‹·è´çš„ä¸€ä¸ªæŒ‡é’ˆï¼Œå¹¶æ²¡æœ‰æ–°å¼€è¾Ÿä¸€ä¸ªåœ°å€ï¼Œæ‹·è´çš„æŒ‡é’ˆå’ŒåŸæ¥çš„æŒ‡é’ˆæŒ‡å‘çš„åŒä¸€å—åœ°å€ï¼Œå¦‚æœåŸæ¥çš„æŒ‡é’ˆæ‰€æŒ‡å‘çš„èµ„æºé‡Šæ”¾äº†ï¼Œé‚£ä¹ˆå†é‡Šæ”¾æµ…æ‹·è´çš„æŒ‡é’ˆèµ„æºå°±ä¼šå‡ºç°é”™è¯¯ã€‚

**æ·±æ‹·è´**

æ·±æ‹·è´ä¸ä»…æ‹·è´å€¼ï¼Œè¿˜å¼€è¾Ÿå‡ºä¸€å—æ–°çš„ç©ºé—´ç”¨æ¥å­˜æ”¾æ–°çš„å€¼ï¼Œå³ä½¿åŸæ¥çš„å¯¹è±¡è¢«ææ„ï¼Œé‡Šæ”¾çš„å†…å­˜ä¹Ÿä¸ä¼šå½±å“åˆ°æ·±æ‹·è´çš„å€¼ã€‚åœ¨è‡ªå·±å®ç°æ‹·è´èµ‹å€¼æ—¶ï¼Œå¦‚æœæœ‰æŒ‡é’ˆå˜é‡éœ€è¦è‡ªå·±å®ç°æ·±æ‹·è´

```cpp
#include<iostream>
#include<string>
using namespace std;

class Student
{
private:
      int num;
      char* name;
public:
      Student()
      {
         name = new char(20);
         cout << "Student" << endl;
      };
      ~Student()
      {
         cout << "~Student"<<endl;
         delete name;
         name = NULL;
      };
      Student(const Student &s){//æ‹·è´æ„é€ å‡½æ•°
         // æµ…æ‹·è´ï¼Œå½“å¯¹è±¡çš„nameå’Œä¼ å…¥å¯¹è±¡çš„name æŒ‡å‘ç›¸åŒçš„åœ°å€
         name = s.name;
         // æ·±æ‹·è´
         //name = new char(20);
         //memcpy(name, s.name, strlen(s.name));
         cout << "copy Student" << endl;
      };

};

int main(){

   {
      Student s1;
      Student s2(s1); //å¤åˆ¶å¯¹è±¡

   }
   return 0;
}

```

æµ…æ‹·è´åœ¨å¯¹è±¡çš„æ‹·è´åˆ›å»ºæ—¶å­˜åœ¨é£é™©ï¼Œå³è¢«æ‹·è´çš„å¯¹è±¡ææ„é‡Šæ”¾èµ„æºåï¼Œæ‹·è´å¯¹è±¡ææ„æ—¶å†æ¬¡é‡Šæ”¾ä¸€ä¸ªå·²ç»é‡Šæ”¾çš„èµ„æºï¼Œæ·±æ‹·è´çš„ç»“æœæ˜¯ä¸¤ä¸ªå¯¹è±¡ä¹‹é—´æ²¡æœ‰ä»»ä½•å…³ç³»ï¼Œå„è‡ªæˆå‘˜åœ°å€ä¸åŒã€‚

## 9.c++çš„å¼‚å¸¸å¤„ç†æ–¹æ³•

å¸¸æœ‰çš„å¼‚å¸¸æœ‰ï¼š
- æ•°ç»„ä¸‹æ ‡è¶Šç•Œ
- é™¤æ³•è®¡ç®—æ—¶é™¤æ•°ä¸º0
- åŠ¨æ€åˆ†é…ç©ºé—´ä¸è¶³

### 9.1 try/throw/catchå…³é”®å­—

| å…³é”®å­—     | ä½œç”¨                               |
| ------- | -------------------------------- |
| `try`   | å®šä¹‰ä¸€ä¸ªå¯èƒ½æŠ›å‡ºå¼‚å¸¸çš„ä»£ç å—ã€‚å¿…é¡»å’Œ `catch` æ­é…ä½¿ç”¨ã€‚ |
| `throw` | æŠ›å‡ºä¸€ä¸ªå¼‚å¸¸ï¼Œå¯ä»¥æ˜¯å†…å»ºç±»å‹æˆ–è‡ªå®šä¹‰ç±»å‹ã€‚            |
| `catch` | æ•è·å¼‚å¸¸ï¼Œå¹¶å®šä¹‰å¦‚ä½•å¤„ç†è¯¥å¼‚å¸¸ã€‚                 |


cppä¸­çš„å¼‚å¸¸å¤„ç†æœºåˆ¶ä¸»è¦ä½¿ç”¨try, throwå’Œcatchä¸‰ä¸ªå…³é”®å­—ï¼Œå…¶åœ¨ç¨‹åºä¸­çš„ç”¨æ³•å¦‚ä¸‹ï¼š
```cpp
#include<iostream>
uusing namespace std;

int main()
{
   double m = 1, n = 0;
   try{
      cout <<"before dividing" << endl;
      if (n == 0)
      {
         throw -1; // æŠ›å‡ºintå‹å¼‚å¸¸
      }
      else if (m == 0){
         throw -1.0; //æŠ›å‡ºdoubleå‹å¼‚å¸¸
      }
      else{
         cout << m / n << endl;
      }
      cout << "after dividing" << endl;
   }
   catch (double d){
      cout << "catch (double)" << d << endl;
   }
   catch (...){
      cout << "catch (...)" << endl;
   }
   cout << "finish" << endl;
   return 0;
}

```
## 10 é™æ€å˜é‡ä»€ä¹ˆæ—¶å€™åˆå§‹åŒ–

1. åˆå§‹åŒ–åªæœ‰ä¸€æ¬¡ï¼Œä½†æ˜¯å¯ä»¥å¤šæ¬¡èµ‹å€¼ï¼Œåœ¨ä¸»ç¨‹åºä¹‹å‰ï¼Œç¼–è¯‘å™¨å·²ç»ä¸ºå…¶åˆ†é…å¥½äº†å†…å­˜
2. é™æ€å±€éƒ¨å˜é‡å’Œå…¨å±€å˜é‡ä¸€æ ·ï¼Œæ•°æ®éƒ½å­˜æ”¾åœ¨å…¨å±€åŒºåŸŸï¼Œæ‰€ä»¥åœ¨ä¸»ç¨‹åºä¹‹å‰ï¼Œç¼–è¯‘å™¨å·²ç»ä¸ºå…¶åˆ†é…å¥½äº†å†…å­˜ï¼Œä½†æ˜¯Cå’ŒC++ä¸­é™æ€å±€éƒ¨å˜é‡çš„åˆå§‹åŒ–èŠ‚ç‚¹åˆæœ‰ç‚¹ä¸ä¸€æ ·ã€‚åœ¨Cä¸­ï¼Œåˆå§‹åŒ–å‘ç”Ÿåœ¨ä»£ç æ‰§è¡Œä¹‹å‰ï¼Œç¼–è¯‘é˜¶æ®µåˆ†é…å¥½å†…å­˜ä¹‹åï¼Œå°±ä¼šè¿›è¡Œåˆå§‹åŒ–ã€‚æ‰€ä»¥æˆ‘ä»¬çœ‹åˆ°åœ¨Cè¯­è¨€ä¸­æ— æ³•ä½¿ç”¨å˜é‡å¯¹é™æ€å±€éƒ¨å˜é‡è¿›è¡Œåˆå§‹åŒ–ï¼Œåœ¨ç¨‹åºè¿è¡Œç»“æŸï¼Œå˜é‡æ‰€å¤„çš„å…¨å±€å†…å­˜ä¼šè¢«å…¨å±€å›æ”¶ï¼›
3. è€Œåœ¨C++ä¸­ï¼Œåœ¨æ‰§è¡Œç›¸å…³ä»£ç æ—¶æ‰ä¼šåˆå§‹åŒ–ï¼Œä¸»è¦æ˜¯ç”±äºC++å¼•å…¥å¯¹è±¡åï¼Œè¦è¿›è¡Œåˆå§‹åŒ–æ‰§è¡Œç›¸åº”æ„é€ å‡½æ•°å’Œææ„å‡½æ•°ï¼Œåœ¨æ„é€ å‡½æ•°æˆ–ææ„å‡½æ•°ä¸­ç»å¸¸ä¼šéœ€è¦è¿›è¡ŒæŸäº›ç¨‹åºä¸­éœ€è¦è¿›è¡Œçš„ç‰¹å®šæ“ä½œï¼Œå¹¶éç®€å•çš„åˆ†é…å†…å­˜ï¼Œæ‰€ä»¥C++æ ‡å‡†å®šä¸ºå…¨å±€æˆ–é™æ€å¯¹è±¡æ˜¯æœ‰é¦–æ¬¡ç”¨åˆ°æ—¶æ‰ä¼šè¿›è¡Œæ„é€ ï¼Œæ‰€ä»¥åœ¨C++ä¸­æ˜¯å¯ä»¥ä½¿ç”¨å˜é‡å¯¹é™æ€å±€éƒ¨å˜é‡è¿›è¡Œåˆå§‹åŒ–ï¼›



## 11 malloc/realloc/callocçš„åŒºåˆ«

malloc

```cpp
void* malloc(unsigned int num_size);
int *p = malloc(20 * sizeof(int)); // ç”³è¯·20ä¸ªintç±»å‹çš„ç©ºé—´
```

calloc

```cpp
void* calloc(size_t n, size_t size);
int *p = calloc(20, sizeof(int)); 
```

çœå»äº†äººä¸ºç©ºé—´è®¡ç®—ï¼Œmallocç”³è¯·çš„ç©ºé—´çš„å€¼æ˜¯éšæœºçš„ï¼Œ callocç”³è¯·çš„ç©ºé—´çš„å€¼æ˜¯åˆå§‹åŒ–ä¸º0çš„ï¼›

realloc

```cpp
void realloc(void *p,  size_t new_size);
```
ç»™åŠ¨æ€åˆ†é…çš„ç©ºé—´åˆ†é…é¢å¤–çš„ç©ºé—´ï¼Œç”¨äºæ‰©å……å®¹é‡



