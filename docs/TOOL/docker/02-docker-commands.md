# dockeråŸºæœ¬å‘½ä»¤

å‚è€ƒ[https://docs.docker.com/reference/cli/docker/](https://docs.docker.com/reference/cli/docker/)

## 1. dockerç®€ä»‹
Docker æ˜¯ä¸€ä¸ªåº”ç”¨æ‰“åŒ…ã€åˆ†å‘ã€éƒ¨ç½²çš„å·¥å…·
- **æ‰“åŒ…**ï¼šæŠŠè½¯ä»¶è¿è¡Œæ‰€éœ€çš„ä¾èµ–ã€ç¬¬ä¸‰æ–¹åº“ã€è½¯ä»¶æ‰“åŒ…åˆ°ä¸€èµ·ï¼Œå˜æˆä¸€ä¸ªå®‰è£…åŒ…
- **åˆ†å‘**ï¼šæŠŠæ‰“åŒ…å¥½çš„â€œå®‰è£…åŒ…â€ä¸Šä¼ åˆ°ä¸€ä¸ªé•œåƒä»“åº“ï¼Œå…¶ä»–äººå¯ä»¥éå¸¸æ–¹ä¾¿çš„è·å–å’Œå®‰è£…
- **éƒ¨ç½²**ï¼šæ‹¿ç€â€œå®‰è£…åŒ…â€å°±å¯ä»¥ä¸€ä¸ªå‘½ä»¤è¿è¡Œèµ·æ¥ä½ çš„åº”ç”¨ï¼Œè‡ªåŠ¨æ¨¡æ‹Ÿå‡ºä¸€æ‘¸ä¸€æ ·çš„è¿è¡Œç¯å¢ƒï¼Œä¸ç®¡æ˜¯åœ¨ Windows/Mac/Linuxç¡®ä¿äº†ä¸åŒæœºå™¨ä¸Šéƒ½æ˜¯ä¸€è‡´çš„è¿è¡Œç¯å¢ƒ
- **é•œåƒ**ï¼šé•œåƒåŒ…å«è¿è¡Œåº”ç”¨ç¨‹åºæ‰€éœ€çš„æ‰€æœ‰å†…å®¹â€”â€”ä»£ç æˆ–äºŒè¿›åˆ¶æ–‡ä»¶ã€è¿è¡Œæ—¶ã€ä¾èµ–é¡¹ä»¥åŠæ‰€éœ€çš„ä»»ä½•å…¶ä»–æ–‡ä»¶ç³»ç»Ÿå¯¹è±¡ã€‚å¯ä»¥ç†è§£ä¸ºè½¯ä»¶å®‰è£…åŒ…ï¼Œå¯ä»¥æ–¹ä¾¿çš„è¿›è¡Œä¼ æ’­å’Œå®‰è£…ã€‚**é•œåƒæ˜¯ä¸€ä¸ªç¨‹åºå®‰è£…åŒ…ï¼Œç”¨æ¥ç”Ÿæˆå®¹å™¨**
- **å®¹å™¨**ï¼šå®¹å™¨åªä¸è¿‡æ˜¯ä¸€ä¸ªæ­£åœ¨è¿è¡Œçš„è¿›ç¨‹ï¼Œå®ƒè¿˜åº”ç”¨äº†ä¸€äº›é™„åŠ çš„å°è£…åŠŸèƒ½ï¼Œä»¥ä½¿å…¶ä¸ä¸»æœºå’Œå…¶ä»–å®¹å™¨ä¿æŒéš”ç¦»ã€‚å®¹å™¨éš”ç¦»çš„æœ€é‡è¦æ–¹é¢ä¹‹ä¸€æ˜¯æ¯ä¸ªå®¹å™¨éƒ½ä¸è‡ªå·±çš„ç§æœ‰æ–‡ä»¶ç³»ç»Ÿè¿›è¡Œäº¤äº’ï¼›è¯¥æ–‡ä»¶ç³»ç»Ÿç”±Dockeré•œåƒæä¾›ã€‚**å®¹å™¨æ˜¯é•œåƒè¿è¡Œçš„å®ä¾‹ï¼Œå®ƒæ˜¯ä¸€ä¸ªå¯è¯»å†™çš„ï¼Œè¿è¡Œä¸­çš„è¿›ç¨‹ç¯å¢ƒ**

## 2. è·å–é•œåƒ
è·å–é•œåƒçš„æ–¹å¼æœ‰ä¸¤ç§ï¼š 
* ä½¿ç”¨ä»–äººæ‰“åŒ…å¥½ï¼Œå¹¶é€šè¿‡ç½‘ç»œï¼ˆä¸»è¦æ˜¯dockerå®˜æ–¹çš„docker hubå’Œä¸€äº›ç±»ä¼¼çš„é•œåƒæ‰˜ç®¡ç½‘ç«™ï¼‰è¿›è¡Œåˆ†äº«çš„é•œåƒï¼›
* åœ¨æœ¬åœ°å°†é•œåƒä¿å­˜ä¸ºæœ¬åœ°æ–‡ä»¶ï¼Œç›´æ¥ä½¿ç”¨ç”Ÿæˆçš„æ–‡ä»¶è¿›è¡Œå…±äº«ã€‚åè€…åœ¨ç½‘ç»œé¦–å…ˆç¯å¢ƒä¸‹æ›´åŠ æ–¹ä¾¿ï¼›

### 2.1 ä»ç½‘ç»œ
è¿™é‡Œä¸»è¦å¯ä»¥å€ŸåŠ©äºä¸¤æ¡æŒ‡ä»¤ã€‚ä¸€ä¸ªæ˜¯ `docker pull` ï¼Œå¦ä¸€ä¸ªæ˜¯ `docker run `
```bash
docker pull [OPTIONS] NAME[:TAG|@DIGEST]
```
ä»ä»“åº“ä¸­æ‹‰å–ï¼ˆpullï¼‰æŒ‡å®šçš„é•œåƒåˆ°æœ¬æœºã€‚
å¯¹åº”äºè¿™é‡Œçš„ä¸‰ç§æ„é€ æŒ‡ä»¤çš„æ–¹å¼ï¼Œæ–‡æ¡£ä¸­ç»™å‡ºäº†å‡ ç§ä¸åŒçš„æ‹‰å–æ–¹å¼ï¼š

* NAME
  * `docker pull ubuntu`
å¦‚æœä¸æŒ‡å®šæ ‡ç­¾ï¼ŒDocker Engineä¼šä½¿ç”¨ :latest ä½œä¸ºé»˜è®¤æ ‡ç­¾æ‹‰å–é•œåƒã€‚
* NAME:TAG
  * `docker pull ubuntu:14.04`
ä½¿ç”¨æ ‡ç­¾æ—¶ï¼Œå¯ä»¥å†æ¬¡ `docker pull` è¿™ä¸ªé•œåƒï¼Œä»¥ç¡®ä¿å…·æœ‰è¯¥é•œåƒçš„æœ€æ–°ç‰ˆæœ¬ã€‚
ä¾‹å¦‚ï¼Œ`docker pull ubuntu:14.04` å°†ä¼šæ‹‰å–`Ubuntu 14.04`é•œåƒçš„æœ€æ–°ç‰ˆæœ¬ã€‚
* NAME@DIGEST
  * `docker pull ubuntu@sha256:45b23dee08af5e43a7fea6c4cf9c25ccf269ee113168c19722f87876677c5cb2`
è¿™ä¸ªä¸ºæˆ‘ä»¬æä¾›äº†ä¸€ç§æŒ‡å®šç‰¹å®šç‰ˆæœ¬é•œåƒçš„æ–¹æ³•
ä¸ºäº†ä¿è¯åæœŸæˆ‘ä»¬ä»…ä»…ä½¿ç”¨è¿™ä¸ªç‰ˆæœ¬çš„é•œåƒï¼Œæˆ‘ä»¬å¯ä»¥é‡æ–°é€šè¿‡æŒ‡å®šDIGESTï¼ˆé€šè¿‡æŸ¥çœ‹é•œåƒæ‰˜ç®¡ç½‘ç«™é‡Œçš„é•œåƒä¿¡æ¯æˆ–è€…æ˜¯ä¹‹å‰çš„ pull è¾“å‡ºé‡Œçš„DIGESTä¿¡æ¯ï¼‰çš„æ–¹å¼ pull è¯¥ç‰ˆæœ¬é•œåƒã€‚


```bash
docker run [OPTIONS] IMAGE [COMMAND] [ARG...]
```

`docker run` å‘½ä»¤é¦–å…ˆåœ¨æŒ‡å®šçš„æ˜ åƒä¸Šåˆ›å»ºä¸€ä¸ªå¯å†™çš„å®¹å™¨å±‚ï¼Œç„¶åä½¿ç”¨æŒ‡å®šçš„å‘½ä»¤å¯åŠ¨å®ƒ

è¿™ä¸ªå®é™…ä¸Šä¼šè‡ªåŠ¨ä»å®˜æ–¹ä»“åº“ä¸­ä¸‹è½½æœ¬åœ°æ²¡æœ‰çš„é•œåƒã€‚æ›´å¤šæ˜¯ä½¿ç”¨ä¼šåœ¨åé¢åˆ›å»ºå®¹å™¨çš„éƒ¨åˆ†ä»‹ç»ã€‚

```bash
$ sudo docker images
REPOSITORY                                             TAG                 IMAGE ID            CREATED             SIZE

$ sudo docker run hello-world
Unable to find image 'hello-world:latest' locally
latest: Pulling from library/hello-world
0e03bdcc26d7: Pull complete 
Digest: sha256:49a1c8800c94df04e9658809b006fd8a686cab8028d33cfba2cc049724254202
Status: Downloaded newer image for hello-world:latest

Hello from Docker!
This message shows that your installation appears to be working correctly.

To generate this message, Docker took the following steps:
 1. The Docker client contacted the Docker daemon.
 2. The Docker daemon pulled the "hello-world" image from the Docker Hub.
    (amd64)
 3. The Docker daemon created a new container from that image which runs the
    executable that produces the output you are currently reading.
 4. The Docker daemon streamed that output to the Docker client, which sent it
    to your terminal.

To try something more ambitious, you can run an Ubuntu container with:
 $ docker run -it ubuntu bash

Share images, automate workflows, and more with a free Docker ID:
 https://hub.docker.com/

For more examples and ideas, visit:
 https://docs.docker.com/get-started/

$ sudo docker images
REPOSITORY                                             TAG                 IMAGE ID            CREATED             SIZE
hello-world                                            latest              bf756fb1ae65        7 months ago        13.3kB

```

### 2.2 ä»ä»–äººå¤„
å…³äºå¦‚ä½•ä¿å­˜é•œåƒåœ¨åé¢ä»‹ç»ï¼Œå…¶æ¶‰åŠåˆ°çš„æŒ‡ä»¤ä¸º `docker save` ï¼Œè¿™é‡Œä¸»è¦è®²å¦‚ä½•åŠ è½½å·²ç»å¯¼å‡ºçš„é•œåƒæ–‡ä»¶ã€‚
```bash
docker load [OPTIONS]
```
ä¾‹å­å¯è§ï¼š[https://docs.docker.com/engine/reference/commandline/load/#examples](https://docs.docker.com/engine/reference/commandline/load/#examples)

## 3. åˆ›å»ºå¹¶å¯åŠ¨ä¸€ä¸ªæ–°å®¹å™¨


`docker run` çš„è¯­æ³•éå¸¸çµæ´»ï¼Œå‚æ•°ä¹Ÿå¾ˆå¤šï¼Œæˆ‘ä»¬æ¥ **åˆ†æ¨¡å—è¯¦ç»†è®²è§£æ¯ä¸ªå‚æ•°çš„æ„ä¹‰å’Œç”¨æ³•**



```bash
docker run [OPTIONS] IMAGE [COMMAND] [ARG...]
```

* `OPTIONS`: è¿è¡Œå‚æ•°ï¼ˆé…ç½®å®¹å™¨çš„è¿è¡Œæ–¹å¼ï¼‰
* `IMAGE`: è¦è¿è¡Œçš„é•œåƒåï¼ˆå¦‚ `ubuntu:20.04`ï¼‰
* `COMMAND`: é•œåƒå†…è¦æ‰§è¡Œçš„å‘½ä»¤ï¼ˆå¯é€‰ï¼Œå¦‚ `bash`ï¼‰



### 3.1 å¯åŠ¨æ¨¡å¼

| å‚æ•°     | è¯´æ˜             | ç¤ºä¾‹                           |
| ------ | -------------- | ---------------------------- |
| `-d`   | åå°è¿è¡Œï¼ˆdetachedï¼‰ | `docker run -d nginx`        |
| `-it`  | äº¤äº’æ¨¡å¼ + ä¼ªç»ˆç«¯     | `docker run -it ubuntu bash` |
| `--rm` | å®¹å™¨é€€å‡ºæ—¶è‡ªåŠ¨åˆ é™¤      | `docker run --rm ubuntu`     |

ğŸ“ è¯´æ˜ï¼š

* `-i`: ä¿æŒè¾“å…¥æµæ‰“å¼€
* `-t`: åˆ†é…ç»ˆç«¯


### 3.2 å®¹å™¨å‘½å

| å‚æ•°       | è¯´æ˜    | ç¤ºä¾‹                              |
| -------- | ----- | ------------------------------- |
| `--name` | æŒ‡å®šå®¹å™¨å | `docker run --name myweb nginx` |


### 3.3 ç«¯å£æ˜ å°„

| å‚æ•°   | è¯´æ˜            | ç¤ºä¾‹                            |
| ---- | ------------- | ----------------------------- |
| `-p` | å°†å®¿ä¸»æœºç«¯å£æ˜ å°„åˆ°å®¹å™¨ç«¯å£ | `docker run -p 8080:80 nginx` |

ğŸŒ å«ä¹‰ï¼šæœ¬æœºçš„ `8080` å¯¹åº”å®¹å™¨çš„ `80`ï¼Œå¯é€šè¿‡ `localhost:8080` è®¿é—®ã€‚


### 3.4 å·æŒ‚è½½ï¼ˆæ•°æ®æŒä¹…åŒ–ï¼‰

| å‚æ•°   | è¯´æ˜          | ç¤ºä¾‹                                      |
| ---- | ----------- | --------------------------------------- |
| `-v` | å°†å®¿ä¸»æœºç›®å½•æŒ‚è½½åˆ°å®¹å™¨ | `docker run -v /host/data:/data ubuntu` |

ğŸ“ å«ä¹‰ï¼šå®¹å™¨å†… `/data` ç›®å½•ä¸å®¿ä¸»æœº `/host/data` åŒæ­¥ã€‚

å½“ç„¶å¯ä»¥ï¼Docker ä¸­çš„æŒ‚è½½æ–¹å¼ä¸»è¦æœ‰ä¸¤ç§ï¼š**ç»‘å®šæŒ‚è½½ï¼ˆbind mountï¼‰** å’Œ **å‘½åå·æŒ‚è½½ï¼ˆnamed volumeï¼‰**ã€‚è¿™ä¸¤ç§æ–¹å¼éƒ½ç”¨äº**å°†æ•°æ®ä»å®¿ä¸»æœºâ€œæŒ‚è½½â€åˆ°å®¹å™¨ä¸­**ï¼Œä½†å®ƒä»¬çš„æœºåˆ¶ã€ç”¨é€”å’Œç®¡ç†æ–¹å¼ä¸åŒã€‚

Docker ä¸­çš„æŒ‚è½½æ–¹å¼ä¸»è¦æœ‰ä¸¤ç§ï¼šç»‘å®šæŒ‚è½½ï¼ˆbind mountï¼‰ å’Œ å‘½åå·æŒ‚è½½ï¼ˆnamed volumeï¼‰ã€‚è¿™ä¸¤ç§æ–¹å¼éƒ½ç”¨äºå°†æ•°æ®ä»å®¿ä¸»æœºâ€œæŒ‚è½½â€åˆ°å®¹å™¨ä¸­ï¼Œä½†å®ƒä»¬çš„æœºåˆ¶ã€ç”¨é€”å’Œç®¡ç†æ–¹å¼ä¸åŒ
#### 3.4.1 ç»‘å®šæŒ‚è½½ï¼ˆBind Mountï¼‰


```bash
-v /å®¿ä¸»æœº/ç›®å½•:/å®¹å™¨/ç›®å½•
```

**demo**
```bash
docker run -v /home/user/html:/usr/share/nginx/html nginx
```

**ç‰¹ç‚¹**

| é¡¹ç›®   | å†…å®¹                          |
| ---- | --------------------------- |
| æ¥æº   | å®¿ä¸»æœºçš„å®é™…è·¯å¾„                    |
| æŒä¹…æ€§  | å®¿ä¸»æœºç›®å½•ä¸€ç›´å­˜åœ¨ï¼Œå®¹å™¨åˆ é™¤ä¹Ÿä¸ä¼šåˆ é™¤æ•°æ®       |
| ç®¡ç†   | ç”±ä½ æ‰‹åŠ¨ç®¡ç†ï¼ˆDocker ä¸è´Ÿè´£ï¼‰          |
| å¯è§æ€§  | å®¿ä¸»æœºå’Œå®¹å™¨å®æ—¶åŒæ­¥ï¼ˆé€‚åˆæœ¬åœ°å¼€å‘ï¼‰          |
| æƒé™æ§åˆ¶ | å¯è®¾ç½®åªè¯»ï¼š`-v /src:/dst:ro`     |
| çµæ´»æ€§  | å¯ä»¥æŒ‚è½½ä»»æ„è·¯å¾„ï¼ŒåŒ…æ‹¬ socketã€æ—¥å¿—ã€é…ç½®æ–‡ä»¶ç­‰ |

**ä½¿ç”¨åœºæ™¯**

* æœ¬åœ°å¼€å‘ï¼ˆä¾‹å¦‚ä»£ç çƒ­æ›´æ–°ï¼‰
* æŒ‡å®šé…ç½®æ–‡ä»¶è·¯å¾„
* æŒ‚è½½æ—¥å¿—ã€æ¨¡å‹ã€è§†é¢‘æ–‡ä»¶ç­‰


#### 3.4.2 å‘½åå·æŒ‚è½½ï¼ˆNamed Volumeï¼‰

**demo**

```bash
docker volume create myvolume
docker run -v myvolume:/usr/share/nginx/html nginx
```

**ç‰¹ç‚¹**ï¼š

| é¡¹ç›®   | å†…å®¹                                                   |
| ---- | ---------------------------------------------------- |
| æ¥æº   | Docker è‡ªåŠ¨åˆ›å»ºå’Œç®¡ç†çš„ç›®å½•ï¼ˆé€šå¸¸åœ¨ `/var/lib/docker/volumes/...`ï¼‰ |
| æŒä¹…æ€§  | ä¸å®¹å™¨ç”Ÿå‘½å‘¨æœŸæ— å…³ï¼ˆåˆ é™¤å®¹å™¨åä»ç„¶ä¿ç•™ï¼‰                                 |
| ç®¡ç†   | é€šè¿‡ `docker volume` å‘½ä»¤é›†ä¸­ç®¡ç†                            |
| å¯è§æ€§  | é»˜è®¤å®¿ä¸»æœºçœ‹ä¸åˆ°æ•°æ®ï¼ˆé™¤éè¿›å…¥ volume è·¯å¾„ï¼‰                           |
| æ•°æ®éš”ç¦» | å®¹å™¨ä¹‹é—´å¯ä»¥å…±äº« Volumeï¼Œä½†é»˜è®¤äº’ä¸å½±å“                              |
| å¯ç§»æ¤æ€§ | å¯ä»¥ç”¨äºå¤‡ä»½/è¿ç§»ï¼ˆé…åˆ `docker volume` å‘½ä»¤ï¼‰                     |

**ä½¿ç”¨åœºæ™¯**

* æ•°æ®åº“å­˜å‚¨ï¼ˆå¦‚ MySQLã€PostgreSQLï¼‰
* éœ€è¦æŒä¹…åŒ–æ•°æ®çš„æœåŠ¡
* å®¹å™¨é—´å…±äº«æ•°æ®ï¼ˆå¯é…åˆ `docker-compose`ï¼‰


**å¯¹æ¯”æ€»ç»“è¡¨**

| å¯¹æ¯”é¡¹     | ç»‘å®šæŒ‚è½½ï¼ˆBind Mountï¼‰ | å‘½åå·ï¼ˆNamed Volumeï¼‰                          |
| ------- | ---------------- | ------------------------------------------ |
| æ•°æ®æ¥æº    | å®¿ä¸»æœºä¸Šä»»æ„ç›®å½•         | Docker ç®¡ç†çš„è·¯å¾„ `/var/lib/docker/volumes/...` |
| åˆ›å»ºæ–¹å¼    | è‡ªåŠ¨æˆ–æ‰‹åŠ¨åˆ›å»ºå®¿ä¸»æœºè·¯å¾„     | `docker volume create` åˆ›å»º                  |
| æŒä¹…æ€§     | ä¸å®¿ä¸»æœºè·¯å¾„ç›¸å…³         | å®¹å™¨åˆ é™¤ä¹Ÿä¸ä¼šåˆ é™¤ volume                           |
| æ•°æ®å…±äº«    | æ‰‹åŠ¨é…ç½®ç›¸åŒå®¿ä¸»æœºè·¯å¾„      | å¤šä¸ªå®¹å™¨å¯æŒ‚è½½åŒä¸€ä¸ª volume                          |
| å®¹å™¨åˆ é™¤åæ•°æ® | ä»ä¿ç•™              | ä»ä¿ç•™                                        |
| ç®¡ç†æ–¹ä¾¿æ€§   | ä¸æ˜“ç»Ÿä¸€ç®¡ç†           | `docker volume ls/inspect/rm` ç®¡ç†           |
| æ–‡ä»¶è®¿é—®æ€§   | å®¿ä¸»æœºä¸Šå¯ç›´æ¥è®¿é—®        | å®¿ä¸»æœºé»˜è®¤ä¸å¯è§                                   |
| æ¨èåœºæ™¯    | æœ¬åœ°å¼€å‘ã€è°ƒè¯•ã€æŒ‚è½½é…ç½®æˆ–æ—¥å¿—ç­‰ | æ•°æ®æŒä¹…åŒ–ã€æ•°æ®åº“ã€å…±äº«ç¼“å­˜                             |

**å‘½ä»¤å‚è€ƒ**

- åˆ›å»ºå‘½åå·

```bash
docker volume create mydata
```

- ä½¿ç”¨å‘½åå·

```bash
docker run -v mydata:/data ubuntu
```

- æŸ¥çœ‹å·

```bash
docker volume ls
docker volume inspect mydata
```

- åˆ é™¤å·

```bash
docker volume rm mydata
```




### 3.5 ç¯å¢ƒå˜é‡

| å‚æ•°   | è¯´æ˜     | ç¤ºä¾‹                              |
| ---- | ------ | ------------------------------- |
| `-e` | è®¾ç½®ç¯å¢ƒå˜é‡ | `docker run -e ENV=prod ubuntu` |


### 3.6 ç½‘ç»œé…ç½®

| å‚æ•°          | è¯´æ˜        | ç¤ºä¾‹                                  |
| ----------- | --------- | ----------------------------------- |
| `--network` | æŒ‡å®šå®¹å™¨è¿æ¥çš„ç½‘ç»œ | `docker run --network mynet ubuntu` |

å¯ä»¥é€šè¿‡ `docker network create` åˆ›å»ºè‡ªå®šä¹‰ç½‘ç»œã€‚


### 3.7 è‡ªåŠ¨é‡å¯ç­–ç•¥ï¼ˆç”¨äºç”Ÿäº§ç¯å¢ƒï¼‰

| å‚æ•°                 | è¯´æ˜        | ç¤ºä¾‹                                  |
| ------------------ | --------- | ----------------------------------- |
| `--restart=always` | å®¹å™¨å´©æºƒåè‡ªåŠ¨é‡å¯ | `docker run --restart=always nginx` |

å¯é€‰å€¼ï¼š

* `no`ï¼ˆé»˜è®¤ï¼‰
* `on-failure`
* `always`
* `unless-stopped`


### 3.8 å®Œæ•´ç¤ºä¾‹ï¼šéƒ¨ç½² Nginx ç½‘ç«™å®¹å™¨

```bash
docker run -d \
  --name my-nginx \
  -p 8080:80 \
  -v /home/user/html:/usr/share/nginx/html \
  --restart=always \
  nginx
```

ğŸ“ å«ä¹‰ï¼š

* åå°è¿è¡Œ
* å®¹å™¨å« `my-nginx`
* æŠŠæœ¬åœ° 8080 æ˜ å°„åˆ°å®¹å™¨ 80 ç«¯å£
* å°†å®¿ä¸»æœºçš„ `/home/user/html` ä½œä¸ºç½‘ç«™æ ¹ç›®å½•
* è‡ªåŠ¨é‡å¯
* ä½¿ç”¨ nginx é•œåƒ





å…¶å® `docker run` ç­‰ä»·äºï¼š

```bash
docker create ...   # åˆ›å»ºå®¹å™¨ï¼ˆä¸è¿è¡Œï¼‰
docker start ...    # å¯åŠ¨å®¹å™¨
```



## 4. å®¹å™¨ç›¸å…³å‘½ä»¤


### 4.1 å®¹å™¨ç”Ÿå‘½å‘¨æœŸç®¡ç†ï¼ˆåˆ›å»ºã€å¯åŠ¨ã€åœæ­¢ç­‰ï¼‰

`docker run` ğŸ‘‰ **åˆ›å»º + å¯åŠ¨å®¹å™¨**

```bash
docker run -it --name mycontainer ubuntu bash
```

* åˆ›å»ºå®¹å™¨å¹¶è¿è¡Œ
* åŠ  `-d` å°±æ˜¯åå°è¿è¡Œ

 `docker start` ğŸ‘‰ å¯åŠ¨ **å·²åˆ›å»ºä½†æœªè¿è¡Œ** çš„å®¹å™¨

```bash
docker start mycontainer
```


 `docker stop` ğŸ‘‰ åœæ­¢æ­£åœ¨è¿è¡Œçš„å®¹å™¨

```bash
docker stop mycontainer
```

* ç­‰åº”ç”¨æ­£å¸¸å…³é—­ï¼Œæœ€é•¿ 10 ç§’åå¼ºåˆ¶åœæ­¢


`docker restart` ğŸ‘‰ é‡å¯å®¹å™¨

```bash
docker restart mycontainer
```


`docker pause / unpause` ğŸ‘‰ æŒ‚èµ· / æ¢å¤å®¹å™¨è¿›ç¨‹

```bash
docker pause mycontainer
docker unpause mycontainer
```


`docker kill` ğŸ‘‰ å¼ºåˆ¶ç»ˆæ­¢å®¹å™¨ï¼ˆç«‹å³å‘é€ SIGKILLï¼‰

```bash
docker kill mycontainer
```


`docker rm` ğŸ‘‰ åˆ é™¤å®¹å™¨ï¼ˆå¿…é¡»å…ˆåœæ­¢ï¼‰

```bash
docker rm mycontainer
docker rm -f mycontainer  # å¼ºåˆ¶åˆ é™¤
```


### 4.2 å®¹å™¨ä¿¡æ¯æŸ¥çœ‹

`docker ps` ğŸ‘‰ æŸ¥çœ‹æ­£åœ¨è¿è¡Œçš„å®¹å™¨

```bash
docker ps
```

`docker ps -a` ğŸ‘‰ æŸ¥çœ‹æ‰€æœ‰å®¹å™¨ï¼ˆåŒ…æ‹¬åœæ­¢çš„ï¼‰

```bash
docker ps -a
```

`docker inspect` ğŸ‘‰ æŸ¥çœ‹å®¹å™¨è¯¦ç»†ä¿¡æ¯ï¼ˆJSONï¼‰

```bash
docker inspect mycontainer
```

å¯æŸ¥çœ‹ï¼š

* å®¹å™¨é…ç½®
* ç½‘ç»œä¿¡æ¯
* æŒ‚è½½å·
* IPã€ç¯å¢ƒå˜é‡ç­‰


`docker stats` ğŸ‘‰ å®æ—¶æŸ¥çœ‹å®¹å™¨èµ„æºå ç”¨ï¼ˆCPUã€å†…å­˜ã€IOï¼‰

```bash
docker stats
```


`docker top` ğŸ‘‰ æŸ¥çœ‹å®¹å™¨å†…çš„è¿›ç¨‹

```bash
docker top mycontainer
```


### 4.3 å®¹å™¨äº¤äº’ä¸æ–‡ä»¶ç®¡ç†

`docker exec` ğŸ‘‰ åœ¨è¿è¡Œä¸­çš„å®¹å™¨å†…æ‰§è¡Œå‘½ä»¤

```bash
docker exec -it mycontainer bash
```

* ç±»ä¼¼ç™»å½•å®¹å™¨ç»ˆç«¯
* ç”¨äºè¿è¡Œè°ƒè¯•å‘½ä»¤ã€æŸ¥çœ‹æ—¥å¿—ã€ä¸´æ—¶ä¿®æ”¹


 `docker attach` ğŸ‘‰ è¿æ¥å®¹å™¨ä¸»ç»ˆç«¯

```bash
docker attach mycontainer
```

ğŸ“Œ æ³¨æ„ï¼š

* æ˜¯è¿æ¥ä¸»è¿›ç¨‹ï¼ˆéæ–°ç»ˆç«¯ï¼‰
* Ctrl+C ä¼šåœæ­¢å®¹å™¨


`docker cp` ğŸ‘‰ å®¹å™¨ä¸å®¿ä¸»æœºä¹‹é—´æ‹·è´æ–‡ä»¶

**ä»å®¿ä¸»æœºæ‹·è´åˆ°å®¹å™¨**

```bash
docker cp ./config.json mycontainer:/app/config.json
```

**ä»å®¹å™¨æ‹·è´åˆ°å®¿ä¸»æœº**

```bash
docker cp mycontainer:/app/log.txt ./log.txt
```


`docker logs` ğŸ‘‰ æŸ¥çœ‹å®¹å™¨çš„æ ‡å‡†è¾“å‡ºæ—¥å¿—

```bash
docker logs mycontainer
docker logs -f mycontainer  # å®æ—¶æŸ¥çœ‹ï¼ˆfollowï¼‰
```


### 4.4 å®¹å™¨æ›´æ–°ä¸ä¿®æ”¹

`docker commit` ğŸ‘‰ æŠŠè¿è¡Œä¸­çš„å®¹å™¨ä¿å­˜æˆé•œåƒ

```bash
docker commit mycontainer mynewimage:v1
```


### 4.5 å®¹å™¨æ¸…ç†

åˆ é™¤æ‰€æœ‰åœæ­¢çš„å®¹å™¨

```bash
docker container prune
```

 åˆ é™¤æ‰€æœ‰å®¹å™¨ï¼ˆå±é™©æ“ä½œï¼‰

```bash
docker rm -f $(docker ps -aq)
```

---

### 4.6 å‘½ä»¤é€ŸæŸ¥è¡¨

| ç±»å‹    | å‘½ä»¤                       | è¯´æ˜              |
| ----- | ------------------------ | --------------- |
| åˆ›å»ºå¹¶è¿è¡Œ | `docker run`             | åˆ›å»ºå¹¶å¯åŠ¨ä¸€ä¸ªæ–°å®¹å™¨      |
| å¯åŠ¨    | `docker start`           | å¯åŠ¨å·²å­˜åœ¨å®¹å™¨         |
| åœæ­¢    | `docker stop`            | åœæ­¢è¿è¡Œçš„å®¹å™¨         |
| å¼ºåˆ¶åœæ­¢  | `docker kill`            | ç«‹å³ä¸­æ­¢å®¹å™¨è¿›ç¨‹        |
| é‡å¯    | `docker restart`         | åœæ­¢+å¯åŠ¨           |
| åˆ é™¤    | `docker rm`              | åˆ é™¤å®¹å™¨            |
| æŸ¥çœ‹    | `docker ps`              | æŸ¥çœ‹è¿è¡Œä¸­å®¹å™¨         |
| æŸ¥çœ‹å…¨éƒ¨  | `docker ps -a`           | åŒ…æ‹¬åœæ­¢çš„å®¹å™¨         |
| æŸ¥çœ‹è¯¦æƒ…  | `docker inspect`         | å®¹å™¨é…ç½®ä¸çŠ¶æ€         |
| æŸ¥çœ‹èµ„æº  | `docker stats`           | CPUã€å†…å­˜ã€I/O å®æ—¶ç›‘æ§ |
| æŸ¥çœ‹è¿›ç¨‹  | `docker top`             | å®¹å™¨å†…è¿è¡Œçš„è¿›ç¨‹        |
| ç™»å½•å®¹å™¨  | `docker exec`            | æ¨èï¼ˆä¸ä¼šå…³é—­ä¸»è¿›ç¨‹ï¼‰     |
| é™„åŠ ç»ˆç«¯  | `docker attach`          | ä¸æ¨èï¼ˆCtrl+C ä¼šé€€å‡ºï¼‰ |
| æŸ¥çœ‹æ—¥å¿—  | `docker logs`            | æ ‡å‡†è¾“å‡ºå†…å®¹          |
| æ–‡ä»¶å¤åˆ¶  | `docker cp`              | å®¿ä¸»æœºå’Œå®¹å™¨é—´äº’æ‹·       |
| ç”Ÿæˆé•œåƒ  | `docker commit`          | æŠŠå®¹å™¨æ‰“åŒ…æˆé•œåƒ        |
| æ¸…ç†å®¹å™¨  | `docker container prune` | åˆ é™¤å…¨éƒ¨å·²åœæ­¢çš„å®¹å™¨      |

---


## 5. ä½¿ç”¨ Dockerfile æ„å»ºé•œåƒï¼ˆæ¨èï¼‰

> **æ ‡å‡†åšæ³•ï¼Œé€‚ç”¨äºå¼€å‘éƒ¨ç½²ç¯å¢ƒã€è‡ªå®šä¹‰æœåŠ¡é•œåƒç­‰**


### 5.1 å‡†å¤‡ä¸€ä¸ª Dockerfileï¼ˆæ— æ‰©å±•åï¼‰

**ç¤ºä¾‹**

```dockerfile
# Dockerfile
FROM ubuntu:20.04                 # åŸºç¡€é•œåƒ
RUN apt update && apt install -y python3
COPY . /app                       # æ‹·è´å½“å‰ç›®å½•æ‰€æœ‰æ–‡ä»¶è¿›é•œåƒ
WORKDIR /app                     # è®¾ç½®å·¥ä½œç›®å½•
CMD ["python3", "main.py"]       # å®¹å™¨å¯åŠ¨æ—¶æ‰§è¡Œçš„å‘½ä»¤
```


### 5.2 æ„å»ºé•œåƒ

```bash
docker build -t my-python-app:v1 .
```

å‚æ•°è¯´æ˜ï¼š

* `-t my-python-app:v1`ï¼šç»™é•œåƒå‘½åå¹¶æ‰“æ ‡ç­¾
* `.`ï¼šè¡¨ç¤ºå½“å‰ç›®å½•ï¼ˆDockerfile å’Œä»£ç æ‰€åœ¨ç›®å½•ï¼‰


### 5.3 æŸ¥çœ‹ç”Ÿæˆçš„é•œåƒ

```bash
docker images
```

ä½ ä¼šçœ‹åˆ°å¦‚ä¸‹ç±»ä¼¼è¾“å‡ºï¼š

```
REPOSITORY        TAG     IMAGE ID       CREATED          SIZE
my-python-app     v1      abcd1234...    10 seconds ago   180MB
```

### 5.4 ä½¿ç”¨é•œåƒè¿è¡Œå®¹å™¨

```bash
docker run -it my-python-app:v1
```

å½“ç„¶å¯ä»¥ï¼æˆ‘ä»¬æ¥**ç³»ç»Ÿè¯¦ç»†åœ°ä»‹ç»** `docker save` å’Œ `docker load`ï¼Œå®ƒä»¬æ˜¯ç”¨äº **é•œåƒçš„å¯¼å‡ºä¸å¯¼å…¥** çš„å‘½ä»¤ï¼Œå¸¸ç”¨äºï¼š

* é•œåƒå¤‡ä»½ï¼ˆæœ¬åœ°ä¿å­˜ï¼‰
* ç¦»çº¿ç¯å¢ƒéƒ¨ç½²ï¼ˆå¦‚æ— ç½‘ç»œçš„æœåŠ¡å™¨ï¼‰
* é•œåƒè¿ç§»ï¼ˆä»ä¸€å°æœºå™¨ç§»åŠ¨åˆ°å¦ä¸€å°ï¼‰

---

## ğŸ§Š `docker save` â€”â€” å¯¼å‡ºé•œåƒä¸º `.tar` æ–‡ä»¶

### ğŸ“Œ ä½œç”¨ï¼š

å°†ä¸€ä¸ªæˆ–å¤šä¸ª Docker é•œåƒå¯¼å‡ºä¸º `.tar` æ–‡ä»¶ï¼Œ**åŒ…å«é•œåƒçš„æ‰€æœ‰å±‚å’Œå…ƒæ•°æ®**ã€‚

### ğŸ“˜ åŸºæœ¬è¯­æ³•ï¼š

```bash
docker save -o <ä¿å­˜è·¯å¾„>.tar <é•œåƒå>:<æ ‡ç­¾>
```

### âœ… ç¤ºä¾‹ï¼š

```bash
docker save -o nginx.tar nginx:latest
```

ç”Ÿæˆä¸€ä¸ª `nginx.tar` æ–‡ä»¶ï¼Œå¯ä»¥å¤åˆ¶ã€ä¼ è¾“ã€å­˜æ¡£ã€‚

---

## 6. å¯¼å‡ºå¯¼å…¥é•œåƒ


ä» `.tar` æ–‡ä»¶ä¸­å¯¼å…¥é•œåƒåˆ°æœ¬åœ° Docker é•œåƒä»“åº“ã€‚


```bash
docker load -i <è·¯å¾„>.tar
```

**demo**

```bash
docker load -i nginx.tar
```

è¾“å‡ºå¦‚ä¸‹ï¼Œè¡¨ç¤ºå¯¼å…¥æˆåŠŸï¼š

```
Loaded image: nginx:latest
```

ç°åœ¨åƒä½¿ç”¨æœ¬åœ°é•œåƒä¸€æ ·è¿è¡Œå®ƒï¼š

```bash
docker run -d -p 8080:80 nginx:latest
```

**ç¤ºä¾‹å®Œæ•´æµç¨‹ï¼šå¤‡ä»½å’Œè¿ç§»é•œåƒ**

ğŸŸ¢ åœ¨æºæœåŠ¡å™¨ä¸Šï¼š

```bash
docker save -o myapp.tar myapp:1.0
scp myapp.tar user@target-server:/home/user/
```

ğŸ”µ åœ¨ç›®æ ‡æœåŠ¡å™¨ä¸Šï¼š

```bash
docker load -i /home/user/myapp.tar
docker run myapp:1.0
```


ä¹Ÿå¯ä»¥å¯¼å‡ºå¤šä¸ªé•œåƒï¼š

```bash
docker save -o all-in-one.tar nginx:latest redis:6.0
```

ç„¶åä½¿ç”¨ `docker load -i all-in-one.tar` ä¸€æ¬¡å¯¼å…¥æ‰€æœ‰ã€‚

 âœ… æ€»ç»“

| å‘½ä»¤            | ä½œç”¨                       | å¸¸ç”¨åœºæ™¯         |
| ------------- | ------------------------ | ------------ |
| `docker save` | å¯¼å‡ºé•œåƒä¸º `.tar` æ–‡ä»¶          | é•œåƒè¿ç§»ã€å¤‡ä»½ã€ç¦»çº¿éƒ¨ç½² |
| `docker load` | ä» `.tar` æ–‡ä»¶åŠ è½½é•œåƒ          | ç¦»çº¿å¯¼å…¥é•œåƒ       |
| æ¨èä½¿ç”¨          | é…åˆ `Dockerfile` æ„å»ºå¥½é•œåƒåå¯¼å‡º | å®‰å…¨å¯é ã€æ˜“ç»´æŠ¤     |


